function getRandomNum(t,e){return Math.random()*(e-t)+t}function onObjectSelected(t){var e=t.target;$("#text-string").val(""),e.hasRotatingPoint=!0,e&&"text"===e.type?($("#texteditor").css("display","block"),$("#text-string").val(e.getText()),$("#text-fontcolor").miniColors("value",e.fill),$("#text-strokecolor").miniColors("value",e.strokeStyle),$("#imageeditor").css("display","block")):e&&"image"===e.type&&($("#texteditor").css("display","none"),$("#imageeditor").css("display","block"))}function onSelectedCleared(){$("#texteditor").css("display","none"),$("#text-string").val(""),$("#imageeditor").css("display","none")}function setFont(t){var e=canvas.getActiveObject();e&&"text"===e.type&&(e.fontFamily=t,canvas.renderAll())}function removeWhite(){var t=canvas.getActiveObject();t&&"image"===t.type&&(t.filters[2]=new fabric.Image.filters.RemoveWhite({hreshold:100,distance:10}),t.applyFilters(canvas.renderAll.bind(canvas)))}var canvas,tshirts=new Array,a,b,line1,line2,line3,line4;$(document).ready(function(){canvas=new fabric.Canvas("tcanvas",{hoverCursor:"pointer",selection:!0,selectionBorderColor:"blue"}),canvas.on({"object:moving":function(t){t.target.opacity=.5},"object:modified":function(t){t.target.opacity=1},"object:selected":onObjectSelected,"selection:cleared":onSelectedCleared}),canvas.findTarget=function(t){return function(){var e=t.apply(this,arguments);return e?this._hoveredTarget!==e&&(canvas.fire("object:over",{target:e}),this._hoveredTarget&&canvas.fire("object:out",{target:this._hoveredTarget}),this._hoveredTarget=e):this._hoveredTarget&&(canvas.fire("object:out",{target:this._hoveredTarget}),this._hoveredTarget=null),e}}(canvas.findTarget),canvas.on("object:over",function(){}),canvas.on("object:out",function(){}),document.getElementById("add-text").onclick=function(){var t=$("#text-string").val(),e=new fabric.Text(t,{left:fabric.util.getRandomInt(0,200),top:fabric.util.getRandomInt(0,400),fontFamily:"helvetica",angle:0,fill:"#000000",scaleX:.5,scaleY:.5,fontWeight:"",hasRotatingPoint:!0});canvas.add(e),canvas.item(canvas.item.length-1).hasRotatingPoint=!0,$("#texteditor").css("display","block"),$("#imageeditor").css("display","block")},$("#text-string").keyup(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.text=this.value,canvas.renderAll())}),$(".img-polaroid").click(function(t){{var e=t.target,n=50,a=fabric.util.getRandomInt(0+n,200-n),c=fabric.util.getRandomInt(0+n,400-n);fabric.util.getRandomInt(-20,40),fabric.util.getRandomInt(30,50),function(t,e){return Math.random()*(e-t)+t}(.5,1)}fabric.Image.fromURL(e.src,function(t){t.set({left:a,top:c,angle:0,padding:10,cornersize:10,hasRotatingPoint:!0}),canvas.add(t)})}),document.getElementById("remove-selected").onclick=function(){var t=canvas.getActiveObject(),e=canvas.getActiveGroup();if(t)canvas.remove(t),$("#text-string").val("");else if(e){var n=e.getObjects();canvas.discardActiveGroup(),n.forEach(function(t){canvas.remove(t)})}},document.getElementById("bring-to-front").onclick=function(){var t=canvas.getActiveObject(),e=canvas.getActiveGroup();if(t)t.bringToFront();else if(e){var n=e.getObjects();canvas.discardActiveGroup(),n.forEach(function(t){t.bringToFront()})}},document.getElementById("send-to-back").onclick=function(){var t=canvas.getActiveObject(),e=canvas.getActiveGroup();if(t)t.sendToBack();else if(e){var n=e.getObjects();canvas.discardActiveGroup(),n.forEach(function(t){t.sendToBack()})}},$("#text-bold").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.fontWeight="bold"==t.fontWeight?"":"bold",canvas.renderAll())}),$("#text-italic").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.fontStyle="italic"==t.fontStyle?"":"italic",canvas.renderAll())}),$("#text-strike").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textDecoration="line-through"==t.textDecoration?"":"line-through",canvas.renderAll())}),$("#text-underline").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textDecoration="underline"==t.textDecoration?"":"underline",canvas.renderAll())}),$("#text-left").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textAlign="left",canvas.renderAll())}),$("#text-center").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textAlign="center",canvas.renderAll())}),$("#text-right").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textAlign="right",canvas.renderAll())}),$("#font-family").change(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.fontFamily=this.value,canvas.renderAll())}),$("#text-bgcolor").miniColors({change:function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.backgroundColor=this.value,canvas.renderAll())},open:function(){},close:function(){}}),$("#text-fontcolor").miniColors({change:function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.fill=this.value,canvas.renderAll())},open:function(){},close:function(){}}),$("#text-strokecolor").miniColors({change:function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.strokeStyle=this.value,canvas.renderAll())},open:function(){},close:function(){}}),$("#drawingArea").hover(function(){canvas.add(line1),canvas.add(line2),canvas.add(line3),canvas.add(line4),canvas.renderAll()},function(){canvas.remove(line1),canvas.remove(line2),canvas.remove(line3),canvas.remove(line4),canvas.renderAll()}),$(".color-preview").click(function(){var t=$(this).css("background-color");document.getElementById("shirtDiv").style.backgroundColor=t}),$("#flip").click(function(){if("Show Back View"==$(this).attr("data-original-title")){$(this).attr("data-original-title","Show Front View"),$("#tshirtFacing").attr("src","img/crew_back.png"),a=JSON.stringify(canvas),canvas.clear();try{{JSON.parse(b)}canvas.loadFromJSON(b)}catch(t){}}else{$(this).attr("data-original-title","Show Back View"),$("#tshirtFacing").attr("src","img/crew_front.png"),b=JSON.stringify(canvas),canvas.clear();try{{JSON.parse(a)}canvas.loadFromJSON(a)}catch(t){}}canvas.renderAll(),setTimeout(function(){canvas.calcOffset()},200)}),$(".clearfix button,a").tooltip(),line1=new fabric.Line([0,0,200,0],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1}),line2=new fabric.Line([199,0,200,399],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1}),line3=new fabric.Line([0,0,0,400],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1}),line4=new fabric.Line([0,400,200,399],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1})});